<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Informasi Bimbingan Skripsi</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --success-color: #27ae60;
            --warning-color: #f39c12;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        
        /* Sidebar Styling */
        #sidebar {
            min-height: 100vh;
            background-color: var(--secondary-color);
            color: white;
            transition: all 0.3s;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        
        #sidebar .sidebar-header {
            padding: 20px;
            background-color: var(--primary-color);
        }
        
        #sidebar ul li a {
            padding: 15px 25px;
            display: block;
            color: #ddd;
            text-decoration: none;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }
        
        #sidebar ul li a:hover {
            background-color: rgba(255,255,255,0.1);
            color: white;
            border-left: 4px solid var(--primary-color);
        }
        
        #sidebar ul li a.active {
            background-color: rgba(255,255,255,0.2);
            color: white;
            border-left: 4px solid var(--primary-color);
        }
        
        #sidebar ul li a i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        #sidebar .sub-menu {
            padding-left: 30px;
            background-color: rgba(0,0,0,0.2);
            display: none;
        }
        
        #sidebar .sub-menu a {
            padding: 12px 20px;
            font-size: 0.9em;
        }
        
        #sidebar .sub-menu.show {
            display: block;
        }
        
        /* Content Styling */
        #content {
            width: 100%;
            min-height: 100vh;
            transition: all 0.3s;
            padding: 20px;
        }
        
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            margin-bottom: 20px;
            border: none;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        
        .card-header {
            background-color: var(--primary-color);
            color: white;
            border-radius: 10px 10px 0 0 !important;
            font-weight: 600;
        }
        
        .table-hover tbody tr:hover {
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
            border-color: #2980b9;
        }
        
        .badge-success {
            background-color: var(--success-color);
        }
        
        .badge-warning {
            background-color: var(--warning-color);
        }
        
        .badge-danger {
            background-color: var(--accent-color);
        }
        
        .tab-content {
            padding: 20px;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 5px 5px;
        }
        
        .nav-tabs .nav-link.active {
            font-weight: bold;
            border-bottom: 3px solid var(--primary-color);
        }
        
        /* Dashboard Stats */
        .stat-card {
            text-align: center;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        
        .stat-card i {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .stat-card h2 {
            font-size: 2rem;
            font-weight: bold;
            margin: 0;
        }
        
        .stat-card p {
            color: #6c757d;
            margin: 0;
        }
        
        /* Main Dashboard Stats */
        .main-stat-card {
            text-align: center;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s;
            height: 100%;
        }
        
        .main-stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .main-stat-card i {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        .main-stat-card h2 {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 0;
        }
        
        .main-stat-card h5 {
            margin-top: 10px;
            font-weight: 600;
        }
        
        .main-stat-card p {
            color: #6c757d;
            margin: 0;
            font-size: 0.9rem;
        }
        
        /* Form Styling */
        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
        }
        
        /* Warning styling for Early Warning */
        .early-warning {
            background-color: #fff3cd;
            border-left: 4px solid var(--warning-color);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 4px;
        }
        
        /* Similarity warning */
        .similarity-high {
            color: var(--accent-color);
            font-weight: bold;
        }
        
        .similarity-medium {
            color: var(--warning-color);
            font-weight: bold;
        }
        
        .similarity-low {
            color: var(--success-color);
            font-weight: bold;
        }
        
        /* Loading spinner */
        .spinner-border {
            width: 3rem; 
            height: 3rem;
            color: var(--primary-color);
        }
        
        /* Autofill styling */
        .autofill-option {
            padding: 8px 12px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }
        
        .autofill-option:hover {
            background-color: #f8f9fa;
        }
        
        .autofill-container {
            position: relative;
        }
        
        .autofill-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 4px 4px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            z-index: 1000;
            display: none;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            #sidebar {
                min-width: 80px;
                max-width: 80px;
                text-align: center;
            }
            
            #sidebar .sidebar-header h3 {
                display: none;
            }
            
            #sidebar ul li a {
                padding: 15px 5px;
                font-size: 0.85em;
            }
            
            #sidebar ul li a i {
                margin-right: 0;
                display: block;
                font-size: 1.5em;
                margin-bottom: 5px;
            }
            
            #sidebar ul li a span {
                display: block;
            }
            
            #sidebar .sub-menu {
                padding-left: 0;
            }
            
            #content {
                width: calc(100% - 80px);
            }
            
            .main-stat-card {
                margin-bottom: 15px;
            }
            
            /* Responsive iframe */
            .google-form-container iframe {
                height: 1200px !important;
            }
        }
        
        /* Notification styling */
        .notification-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
            min-width: 300px;
        }
    </style>
</head>
<body>
    <!-- Notification Toast -->
    <div class="notification-toast toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="true" data-bs-delay="5000">
        <div class="toast-header">
            <strong class="me-auto">SIBiS Notification</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body"></div>
    </div>

    <div class="d-flex" id="wrapper">
        <!-- Sidebar -->
        <div class="bg-dark" id="sidebar">
            <div class="sidebar-header">
                <h3 class="m-0">Sistem Informasi Bimbingan Skripsi</h3>
            </div>
            
            <ul class="list-unstyled">
                <li>
                    <a href="#bimbinganSubmenu" data-bs-toggle="collapse" class="dropdown-toggle active">
                        <i class="fas fa-graduation-cap"></i>
                        <span>Bimbingan</span>
                    </a>
                    <ul class="sub-menu show collapse list-unstyled" id="bimbinganSubmenu">
                        <li>
                            <a href="#pengajuan" class="sub-item active">
                                <i class="fas fa-file-upload"></i>
                                <span>Pengajuan Proposal</span>
                            </a>
                        </li>
                        <li>
                            <a href="#dataBimbingan" class="sub-item">
                                <i class="fas fa-database"></i>
                                <span>Data Bimbingan</span>
                            </a>
                        </li>
                        <li>
                            <a href="#tahapBimbingan" class="sub-item">
                                <i class="fas fa-tasks"></i>
                                <span>Tahap Bimbingan</span>
                            </a>
                        </li>
                        <li>
                            <a href="#statusBimbingan" class="sub-item">
                                <i class="fas fa-chart-line"></i>
                                <span>Status Bimbingan</span>
                            </a>
                        </li>
                        <li>
                            <a href="#earlyWarning" class="sub-item">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span>Early Warning</span>
                            </a>
                        </li>
                    </ul>
                </li>
                
                <li>
                    <a href="#skripsiSubmenu" data-bs-toggle="collapse" class="dropdown-toggle">
                        <i class="fas fa-book"></i>
                        <span>Skripsi</span>
                    </a>
                    <ul class="sub-menu collapse list-unstyled" id="skripsiSubmenu">
                        <li>
                            <a href="#databaseSkripsi" class="sub-item">
                                <i class="fas fa-search"></i>
                                <span>Database Skripsi</span>
                            </a>
                        </li>
                        <li>
                            <a href="#uploadSkripsi" class="sub-item">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <span>Upload Skripsi Final</span>
                            </a>
                        </li>
                    </ul>
                </li>
                
                <li>
                    <a href="#statistik" class="main-item">
                        <i class="fas fa-chart-bar"></i>
                        <span>Statistik</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- Page Content -->
        <div id="content">
            <div class="container-fluid">
                <!-- Main Dashboard Stats -->
                <div class="row mb-4" id="mainDashboardStats">
                    <div class="col-md-3 col-sm-6 mb-3">
                        <div class="card main-stat-card bg-primary text-white" data-target="databaseSkripsi">
                            <i class="fas fa-book"></i>
                            <h2 id="totalSkripsiMain">0</h2>
                            <h5>Total Skripsi</h5>
                            <p>Seluruh judul skripsi</p>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6 mb-3">
                        <div class="card main-stat-card bg-info text-white" data-target="dataBimbingan">
                            <i class="fas fa-graduation-cap"></i>
                            <h2 id="totalBimbinganMain">0</h2>
                            <h5>Total Bimbingan</h5>
                            <p>Mahasiswa dalam bimbingan</p>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6 mb-3">
                        <div class="card main-stat-card bg-success text-white" data-target="statusBimbingan">
                            <i class="fas fa-check-circle"></i>
                            <h2 id="selesaiBimbinganMain">0</h2>
                            <h5>Selesai</h5>
                            <p>Bimbingan telah selesai</p>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6 mb-3">
                        <div class="card main-stat-card bg-warning text-white" data-target="earlyWarning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <h2 id="earlyWarningMain">0</h2>
                            <h5>Early Warning</h5>
                            <p>Perlu perhatian khusus</p>
                        </div>
                    </div>
                </div>
                
                <!-- Bimbingan Section -->
                <div id="bimbinganContent">
                    <!-- Pengajuan Proposal - Diubah dari iframe ke form HTML -->
                    <div class="content-section" id="pengajuan">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">Pengajuan Proposal Skripsi</h5>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle"></i> Pastikan proposal telah melalui konsultasi dengan calon pembimbing sebelum diajukan.
                                </div>
                                
                                <form id="pengajuanProposalForm">
                                    <div class="mb-3">
                                        <label for="nimProposal" class="form-label">NIM</label>
                                        <input type="text" class="form-control" id="nimProposal" required>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="namaProposal" class="form-label">Nama Lengkap</label>
                                        <input type="text" class="form-control" id="namaProposal" required>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="prodiProposal" class="form-label">Program Studi</label>
                                        <select class="form-select" id="prodiProposal" required>
                                            <option value="">Pilih Program Studi</option>
                                            <option value="ES">Ekonomi Syariah</option>
                                            <option value="PS">Perbankan Syariah</option>
                                            <option value="MBS">Manajemen Bisnis Syariah</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="tahunAkademik" class="form-label">Tahun Akademik</label>
                                        <select class="form-select" id="tahunAkademik" required>
                                            <option value="">Pilih Tahun Akademik</option>
                                            <!-- Options akan diisi oleh JavaScript -->
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="judulProposal" class="form-label">Judul Proposal</label>
                                        <textarea class="form-control" id="judulProposal" rows="3" required></textarea>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="dosenPembimbing1" class="form-label">Dosen Pembimbing 1</label>
                                        <select class="form-select" id="dosenPembimbing1" required>
                                            <option value="">Pilih Dosen Pembimbing 1</option>
                                            <!-- Options akan diisi oleh JavaScript -->
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="dosenPembimbing2" class="form-label">Dosen Pembimbing 2 (opsional)</label>
                                        <select class="form-select" id="dosenPembimbing2">
                                            <option value="">Pilih Dosen Pembimbing 2 (jika diperlukan)</option>
                                            <!-- Options akan diisi oleh JavaScript -->
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="fileProposal" class="form-label">Upload Proposal</label>
                                        <input type="file" class="form-control" id="fileProposal" accept=".pdf,.doc,.docx" required>
                                        <div class="form-text">Format file: PDF atau DOC/DOCX (maks. 10MB)</div>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-paper-plane"></i> Ajukan Proposal
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Data Bimbingan -->
                    <div class="content-section" id="dataBimbingan" style="display: none;">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">Data Bimbingan Skripsi</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover" id="tableBimbingan">
                                        <thead>
                                            <tr>
                                                <th>NIM</th>
                                                <th>Nama</th>
                                                <th>Prodi</th>
                                                <th>Pembimbing 1</th>
                                                <th>Pembimbing 2</th>
                                                <th>Judul</th>
                                                <th>Status</th>
                                                <th>Aksi</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Data will be populated by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tahap Bimbingan -->
                    <div class="content-section" id="tahapBimbingan" style="display: none;">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">Tahap Bimbingan Skripsi</h5>
                            </div>
                            <div class="card-body">
                                <div class="progress mb-4" style="height: 30px;">
                                    <div class="progress-bar" role="progressbar" style="width: 25%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">Pengajuan Judul</div>
                                    <div class="progress-bar bg-success" role="progressbar" style="width: 25%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">Bimbingan Proposal</div>
                                    <div class="progress-bar bg-info" role="progressbar" style="width: 25%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">Seminar Hasil</div>
                                    <div class="progress-bar bg-warning" role="progressbar" style="width: 25%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">Bimbingan Skripsi</div>
                                </div>
                                
                                <div class="table-responsive">
                                    <table class="table table-hover" id="tableTahapBimbingan">
                                        <thead>
                                            <tr>
                                                <th>NIM</th>
                                                <th>Nama</th>
                                                <th>Tahap</th>
                                                <th>Progress</th>
                                                <th>Terakhir Update</th>
                                                <th>Aksi</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Data will be populated by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Status Bimbingan -->
                    <div class="content-section" id="statusBimbingan" style="display: none;">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">Status Bimbingan Skripsi</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-4">
                                    <div class="col-md-3">
                                        <div class="card stat-card">
                                            <i class="fas fa-users"></i>
                                            <h2 id="totalBimbingan">0</h2>
                                            <p>Total Bimbingan</p>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card stat-card">
                                            <i class="fas fa-check-circle"></i>
                                            <h2 id="selesaiBimbingan">0</h2>
                                            <p>Selesai</p>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card stat-card">
                                            <i class="fas fa-spinner"></i>
                                            <h2 id="prosesBimbingan">0</h2>
                                            <p>Dalam Proses</p>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card stat-card">
                                            <i class="fas fa-exclamation-triangle"></i>
                                            <h2 id="terlambatBimbingan">0</h2>
                                            <p>Terlambat</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="table-responsive">
                                    <table class="table table-hover" id="tableStatusBimbingan">
                                        <thead>
                                            <tr>
                                                <th>NIM</th>
                                                <th>Nama</th>
                                                <th>Prodi</th>
                                                <th>Judul</th>
                                                <th>Status</th>
                                                <th>Progress</th>
                                                <th>Estimasi Selesai</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Data will be populated by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Early Warning -->
                    <div class="content-section" id="earlyWarning" style="display: none;">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">Early Warning System</h5>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-warning">
                                    <i class="fas fa-exclamation-triangle"></i> 
                                    Sistem ini memberikan peringatan dini kepada mahasiswa semester 11-14 yang belum menyelesaikan skripsi.
                                </div>
                                
                                <div class="table-responsive">
                                    <table class="table table-hover" id="tableEarlyWarning">
                                        <thead>
                                            <tr>
                                                <th>NIM</th>
                                                <th>Nama</th>
                                                <th>Prodi</th>
                                                <th>Semester</th>
                                                <th>Status</th>
                                                <th>Peringatan</th>
                                                <th>Aksi</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Data will be populated by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Skripsi Section -->
                <div id="skripsiContent" style="display: none;">
                    <!-- Database Skripsi -->
                    <div class="content-section" id="databaseSkripsi">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">Database Skripsi</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-3">
                                        <label for="filterTahun" class="form-label">Tahun Lulus</label>
                                        <select class="form-select" id="filterTahun">
                                            <option value="">Semua Tahun</option>
                                            <!-- Options will be populated by JavaScript -->
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label for="filterProdi" class="form-label">Program Studi</label>
                                        <select class="form-select" id="filterProdi">
                                            <option value="">Semua Program Studi</option>
                                            <option value="ES">Ekonomi Syariah</option>
                                            <option value="PS">Perbankan Syariah</option>
                                            <option value="MBS">Manajemen Bisnis Syariah</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label for="filterStatus" class="form-label">Status</label>
                                        <select class="form-select" id="filterStatus">
                                            <option value="">Semua Status</option>
                                            <option value="Lulus">Lulus</option>
                                            <option value="Proses">Dalam Proses</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label for="searchJudul" class="form-label">Pencarian Judul</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="searchJudul" placeholder="Cari judul...">
                                            <button class="btn btn-primary" type="button" id="btnSearch">
                                                <i class="fas fa-search"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="table-responsive">
                                    <table class="table table-hover" id="tableSkripsi">
                                        <thead>
                                            <tr>
                                                <th>Judul</th>
                                                <th>Penulis</th>
                                                <th>Tahun</th>
                                                <th>Prodi</th>
                                                <th>Pembimbing 1</th>
                                                <th>Pembimbing 2</th>
                                                <th>Status</th>
                                                <th>Aksi</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Data will be populated by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Upload Skripsi Final -->
                    <div class="content-section" id="uploadSkripsi" style="display: none;">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">Upload Skripsi Final</h5>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle"></i> 
                                    Upload skripsi final yang telah disetujui oleh pembimbing dan telah melalui proses sidang.
                                </div>
                                
                                <form id="uploadSkripsiForm">
                                    <div class="mb-3 autofill-container">
                                        <label for="nimSkripsi" class="form-label">NIM</label>
                                        <input type="text" class="form-control" id="nimSkripsi" required>
                                        <div class="autofill-suggestions" id="nimSuggestions"></div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="namaSkripsi" class="form-label">Nama Lengkap</label>
                                        <input type="text" class="form-control" id="namaSkripsi" required>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="prodiSkripsi" class="form-label">Program Studi</label>
                                        <select class="form-select" id="prodiSkripsi" required>
                                            <option value="">Pilih Program Studi</option>
                                            <option value="ES">Ekonomi Syariah</option>
                                            <option value="PS">Perbankan Syariah</option>
                                            <option value="MBS">Manajemen Bisnis Syariah</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="judulSkripsiFinal" class="form-label">Judul Skripsi Final</label>
                                        <textarea class="form-control" id="judulSkripsiFinal" rows="2" required></textarea>
                                    </div>
                                    
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="tahunLulus" class="form-label">Tahun Lulus</label>
                                            <select class="form-select" id="tahunLulus" required>
                                                <option value="">Pilih Tahun Lulus</option>
                                                <!-- Options will be populated by JavaScript -->
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="tanggalSidang" class="form-label">Tanggal Sidang</label>
                                            <input type="date" class="form-control" id="tanggalSidang" required>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="fileSkripsi" class="form-label">Upload Skripsi Final</label>
                                        <input type="file" class="form-control" id="fileSkripsi" accept=".pdf" required>
                                        <div class="form-text">Format file: PDF (maks. 10MB)</div>
                                    </div>
                                    
                                    <div class="mb-3 form-check">
                                        <input type="checkbox" class="form-check-input" id="approvalCheck" required>
                                        <label class="form-check-label" for="approvalCheck">
                                            Saya menyatakan bahwa skripsi yang diupload adalah versi final yang telah disetujui oleh pembimbing dan panitia sidang
                                        </label>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-success">
                                        <i class="fas fa-upload"></i> Upload Skripsi Final
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Statistik Section -->
                <div id="statistikContent" style="display: none;">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Statistik Bimbingan per Prodi</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="prodiChart" height="250"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Status Penyelesaian Skripsi</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="statusChart" height="250"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Rata-rata Waktu Penyelesaian</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="waktuChart" height="250"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Trend Jumlah Skripsi per Tahun</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="trendChart" height="250"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap & jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Google Apps Script Web App URL
        const scriptUrl = 'https://script.google.com/macros/s/AKfycbwEtJlz4whAIRpzCicLMR1EJmweNwwVN5MDTQIA_-w_9WMSMmYWIPXeUYfVCdIdKAnWhw/exec';
        
        // Global variables
        let currentSection = 'pengajuan';
        let currentMenu = 'bimbingan';
        let bimbinganData = [];
        let skripsiData = [];
        let earlyWarningData = [];
        let dosenList = [];
        
        // Initialize dashboard
        $(document).ready(function() {
            // Initialize sidebar menu
            initSidebarMenu();
            
            // Load initial data
            loadInitialData();
            
            // Initialize tahun akademik options
            initTahunAkademik();
            
            // Initialize dosen options
            initDosenOptions();
            
            // Initialize charts
            initCharts();
            
            // Initialize toast notifications
            $('.toast').toast();
            
            // Add click events to main stat cards
            $('.main-stat-card').click(function() {
                const target = $(this).data('target');
                
                if (target === 'databaseSkripsi') {
                    // Open Skripsi menu and show database
                    $('#skripsiSubmenu').collapse('show');
                    setTimeout(function() {
                        $('#skripsiContent').show();
                        $('#bimbinganContent, #statistikContent').hide();
                        $('a[href="#databaseSkripsi"]').click();
                    }, 300);
                } else {
                    // Open Bimbingan menu and show target section
                    $('#bimbinganSubmenu').collapse('show');
                    setTimeout(function() {
                        $('#bimbinganContent').show();
                        $('#skripsiContent, #statistikContent').hide();
                        $(`a[href="#${target}"]`).click();
                    }, 300);
                }
            });

            // Add event listener for NIM input to autofill data
            $('#nimSkripsi').on('input', function() {
                const nim = $(this).val().trim();
                if (nim.length > 0) {
                    // Find the student data by NIM in bimbinganData
                    const studentData = bimbinganData.find(item => item.NIM === nim);
                    if (studentData) {
                        // If found, autofill and disable fields
                        $('#namaSkripsi').val(studentData.Nama).prop('readonly', true);
                        $('#prodiSkripsi').val(studentData.Prodi).prop('disabled', true);
                        $('#judulSkripsiFinal').val(studentData.Judul);
                    } else {
                        // If not found, enable fields and clear
                        $('#namaSkripsi').val('').prop('readonly', false);
                        $('#prodiSkripsi').val('').prop('disabled', false);
                        $('#judulSkripsiFinal').val('');
                    }
                } else {
                    $('#namaSkripsi').val('').prop('readonly', false);
                    $('#prodiSkripsi').val('').prop('disabled', false);
                    $('#judulSkripsiFinal').val('');
                }
            });

            // Event handler untuk form pengajuan proposal
            $('#pengajuanProposalForm').submit(function(e) {
                e.preventDefault();
                
                // Basic validation
                const nim = $('#nimProposal').val();
                const nama = $('#namaProposal').val();
                const prodi = $('#prodiProposal').val();
                const tahunAkademik = $('#tahunAkademik').val();
                const judul = $('#judulProposal').val();
                const dosenPembimbing1 = $('#dosenPembimbing1').val();
                const dosenPembimbing1Nama = $('#dosenPembimbing1 option:selected').text();
                const dosenPembimbing2 = $('#dosenPembimbing2').val();
                const dosenPembimbing2Nama = $('#dosenPembimbing2 option:selected').text();
                const fileInput = $('#fileProposal')[0];
                
                if (!nim || !nama || !prodi || !tahunAkademik || !judul || !dosenPembimbing1 || !fileInput.files[0]) {
                    showNotification('Harap lengkapi semua field yang wajib diisi', 'warning');
                    return;
                }
                
                const file = fileInput.files[0];
                
                // Validate file size
                if (file.size > 10 * 1024 * 1024) { // 10MB
                    showNotification('Ukuran file terlalu besar. Maksimal 10MB.', 'warning');
                    return;
                }
                
                // Show loading
                const submitBtn = $(this).find('button[type="submit"]');
                const originalText = submitBtn.html();
                submitBtn.html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Mengajukan...');
                submitBtn.prop('disabled', true);
                
                // Convert file to base64
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = function() {
                    const base64 = reader.result.split(',')[1];
                    
                    // Prepare data for submission
                    const formData = new FormData();
                    formData.append('action', 'uploadProposal');
                    formData.append('nim', nim);
                    formData.append('nama', nama);
                    formData.append('prodi', prodi);
                    formData.append('tahunAkademik', tahunAkademik);
                    formData.append('judul', judul);
                    formData.append('dosenPembimbing1', dosenPembimbing1);
                    formData.append('dosenPembimbing1Nama', dosenPembimbing1Nama);
                    formData.append('dosenPembimbing2', dosenPembimbing2 || '');
                    formData.append('dosenPembimbing2Nama', dosenPembimbing2Nama || '');
                    formData.append('filename', file.name);
                    formData.append('mimeType', file.type);
                    formData.append('file', base64);
                    
                    // Send data to Google Apps Script
                    fetch(scriptUrl, {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.result === 'success') {
                            showNotification('Proposal berhasil diajukan!', 'success');
                            $('#pengajuanProposalForm')[0].reset();
                            
                            // Reload data to reflect changes
                            loadInitialData();
                        } else {
                            showNotification('Terjadi kesalahan: ' + data.message, 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showNotification('Terjadi kesalahan saat mengajukan proposal.', 'error');
                    })
                    .finally(() => {
                        // Restore button
                        submitBtn.html(originalText);
                        submitBtn.prop('disabled', false);
                    });
                };
                
                reader.onerror = function(error) {
                    console.error('Error reading file:', error);
                    showNotification('Terjadi kesalahan saat membaca file.', 'error');
                    submitBtn.html(originalText);
                    submitBtn.prop('disabled', false);
                };
            });
        });
        
        // Initialize sidebar menu functionality
        function initSidebarMenu() {
            // Main menu click event
            $('.main-item').click(function(e) {
                e.preventDefault();
                
                const target = $(this).attr('href');
                
                // Hide all content sections
                $('#bimbinganContent, #skripsiContent, #statistikContent').hide();
                
                // Show target content
                if (target === '#statistik') {
                    $('#statistikContent').show();
                    currentMenu = 'statistik';
                    loadStatistikData();
                }
                
                // Update active menu
                $('.main-item').removeClass('active');
                $(this).addClass('active');
            });
            
            // Submenu click event for Bimbingan
            $('.sub-item').click(function(e) {
                e.preventDefault();
                
                const target = $(this).attr('href');
                
                // Hide all content sections in Bimbingan
                $('#bimbinganContent .content-section').hide();
                
                // Show target content
                $(target).show();
                currentSection = target.substring(1);
                
                // Load data if needed
                if (currentSection === 'dataBimbingan') {
                    loadBimbinganData();
                } else if (currentSection === 'tahapBimbingan') {
                    loadTahapBimbingan();
                } else if (currentSection === 'statusBimbingan') {
                    loadStatusBimbingan();
                } else if (currentSection === 'earlyWarning') {
                    loadEarlyWarning();
                }
                
                // Update active submenu
                $('.sub-item').removeClass('active');
                $(this).addClass('active');
            });
            
            // Bimbingan menu toggle
            $('#bimbinganSubmenu').on('show.bs.collapse', function() {
                currentMenu = 'bimbingan';
                $('#bimbinganContent').show();
                $('#skripsiContent, #statistikContent').hide();
                
                // Update active menu
                $('.main-item').removeClass('active');
                $('a[href="#bimbinganSubmenu"]').addClass('active');
            });
            
            // Skripsi menu toggle
            $('#skripsiSubmenu').on('show.bs.collapse', function() {
                currentMenu = 'skripsi';
                $('#skripsiContent').show();
                $('#bimbinganContent, #statistikContent').hide();
                
                // Update active menu
                $('.main-item').removeClass('active');
                $('a[href="#skripsiSubmenu"]').addClass('active');
                
                // Load data if needed
                loadSkripsiData();
            });
            
            // Submenu click event for Skripsi
            $('#skripsiSubmenu .sub-item').click(function(e) {
                e.preventDefault();
                
                const target = $(this).attr('href');
                
                // Hide all content sections in Skripsi
                $('#skripsiContent .content-section').hide();
                
                // Show target content
                $(target).show();
                
                // Load data if needed
                if (target === '#databaseSkripsi') {
                    loadSkripsiData();
                }
                
                // Update active submenu
                $('#skripsiSubmenu .sub-item').removeClass('active');
                $(this).addClass('active');
            });
        }
        
        // Load initial data
        function loadInitialData() {
            // Show loading state
            showLoading();
            
            // Load dosen data first
            $.ajax({
                url: scriptUrl,
                method: 'GET',
                dataType: 'json',
                data: {
                    action: 'getDosen'
                },
                success: function(response) {
                    dosenList = response;
                    initDosenOptions();
                    
                    // Then load other data
                    loadBimbinganDataFromServer();
                    loadSkripsiDataFromServer();
                    loadEarlyWarningDataFromServer();
                    loadSkripsiFinalDataFromServer();
                },
                error: function(error) {
                    console.error('Error loading dosen data:', error);
                    // If failed to load dosen data, use default list
                    dosenList = [
                        {id: 1, nama: "Prof. Dr. Hj. Darmawati, M. Hum"},
                        {id: 2, nama: "Dr. H. Moh. Mahrus, M. HI"},
                        {id: 3, nama: "Dr. Iskandar, M. Ag."},
                        {id: 4, nama: "Dr. Hj. Wahdatunnisa, M.A."},
                        {id: 5, nama: "Dr. Tikawati, M. SI."},
                        {id: 6, nama: "Dr. Hj. Norvadewi, M. Ag."},
                        {id: 7, nama: "Nurul Fadhilah, M.E."},
                        {id: 8, nama: "Fitria Rahmah, M. E."},
                        {id: 9, nama: "Tika Parlina, M. E."},
                        {id: 10, nama: "Irma Yuliani, M. E."},
                        {id: 11, nama: "Dedy Mainata, M. Ag."},
                        {id: 12, nama: "Rista Aribowo, M. E"},
                        {id: 13, nama: "Ahmad Nurzaroni, M. Ag."},
                        {id: 14, nama: "H. Yusran, M. Ag."},
                        {id: 15, nama: "Nur Rahmatullah, M. SI."},
                        {id: 16, nama: "Ahmad Syarif, M. Sc."},
                        {id: 17, nama: "Alias Chandra, M. SI."},
                        {id: 17, nama: "Iswadi, M. SI."}
                    ];
                    initDosenOptions();
                    
                    // Load other data
                    loadBimbinganDataFromServer();
                    loadSkripsiDataFromServer();
                    loadEarlyWarningDataFromServer();
                    loadSkripsiFinalDataFromServer();
                }
            });
        }
        
        // Load bimbingan data from server
        function loadBimbinganDataFromServer() {
            $.ajax({
                url: scriptUrl,
                method: 'GET',
                dataType: 'json',
                data: {
                    action: 'getBimbingan'
                },
                success: function(response) {
                    bimbinganData = response;
                    loadBimbinganData();
                    updateMainStats();
                },
                error: function(error) {
                    console.error('Error loading bimbingan data:', error);
                    hideLoading();
                }
            });
        }
        
        // Load skripsi data from server
        function loadSkripsiDataFromServer() {
            $.ajax({
                url: scriptUrl,
                method: 'GET',
                dataType: 'json',
                data: {
                    action: 'getSkripsi'
                },
                success: function(response) {
                    skripsiData = response;
                    updateMainStats();
                },
                error: function(error) {
                    console.error('Error loading skripsi data:', error);
                }
            });
        }
        
        // Load early warning data from server
        function loadEarlyWarningDataFromServer() {
            $.ajax({
                url: scriptUrl,
                method: 'GET',
                dataType: 'json',
                data: {
                    action: 'getEarlyWarning'
                },
                success: function(response) {
                    earlyWarningData = response;
                    updateMainStats();
                },
                error: function(error) {
                    console.error('Error loading early warning data:', error);
                }
            });
        }
        
        // Load skripsi final data from server
        function loadSkripsiFinalDataFromServer() {
            $.ajax({
                url: scriptUrl,
                method: 'GET',
                dataType: 'json',
                data: {
                    action: 'getSkripsiFinal'
                },
                success: function(response) {
                    updateMainStats();
                },
                error: function(error) {
                    console.error('Error loading skripsi final data:', error);
                }
            });
        }
        
        // Update main dashboard statistics
        function updateMainStats() {
            // Update total skripsi
            $('#totalSkripsiMain').text(skripsiData.length);
            
            // Update total bimbingan
            $('#totalBimbinganMain').text(bimbinganData.length);
            
            // Update selesai bimbingan
            const selesaiCount = bimbinganData.filter(item => item.Status === 'Selesai').length;
            $('#selesaiBimbinganMain').text(selesaiCount);
            
            // Update early warning
            $('#earlyWarningMain').text(earlyWarningData.length);
        }
        
        // Initialize tahun akademik options
        function initTahunAkademik() {
            const currentYear = new Date().getFullYear();
            const selectElement = $('#tahunAkademik');
            
            // Clear existing options
            selectElement.empty();
            selectElement.append('<option value="">Pilih Tahun Akademik</option>');
            
            // Add options for the last 5 years and current year
            for (let i = 4; i >= 0; i--) {
                const year = currentYear - i;
                const academicYear = year + '/' + (year + 1);
                selectElement.append(`<option value="${academicYear}">${academicYear}</option>`);
            }
            
            // Also initialize for tahun lulus
            $('#tahunLulus').empty();
            $('#tahunLulus').append('<option value="">Pilih Tahun Lulus</option>');
            $('#filterTahun').empty();
            $('#filterTahun').append('<option value="">Semua Tahun</option>');
            
            for (let i = 4; i >= 0; i--) {
                const year = currentYear - i;
                $('#tahunLulus').append(`<option value="${year}">${year}</option>`);
                $('#filterTahun').append(`<option value="${year}">${year}</option>`);
            }
        }
        
        // Initialize dosen options
        function initDosenOptions() {
            const selectPembimbing1 = $('#dosenPembimbing1');
            const selectPembimbing2 = $('#dosenPembimbing2');
            
            // Clear existing options
            selectPembimbing1.empty();
            selectPembimbing2.empty();
            
            // Add default options
            selectPembimbing1.append('<option value="">Pilih Dosen Pembimbing 1</option>');
            selectPembimbing2.append('<option value="">Pilih Dosen Pembimbing 2 (jika diperlukan)</option>');
            
            // Add dosen options
            dosenList.forEach(dosen => {
                selectPembimbing1.append(`<option value="${dosen.id}">${dosen.nama}</option>`);
                selectPembimbing2.append(`<option value="${dosen.id}">${dosen.nama}</option>`);
            });
        }
        
        // Load bimbingan data to table
        function loadBimbinganData() {
            const tableBody = $('#tableBimbingan tbody');
            tableBody.empty();
            
            if (bimbinganData.length === 0) {
                tableBody.append('<tr><td colspan="8" class="text-center">Tidak ada data bimbingan</td></tr>');
                return;
            }
            
            bimbinganData.forEach(item => {
                const statusClass = getStatusClass(item.Status);
                
                const row = `
                    <tr>
                        <td>${item.NIM || ''}</td>
                        <td>${item.Nama || ''}</td>
                        <td>${getProdiName(item.Prodi) || ''}</td>
                        <td>${item.Pembimbing1 || ''}</td>
                        <td>${item.Pembimbing2 || ''}</td>
                        <td>${item.Judul || ''}</td>
                        <td><span class="badge ${statusClass}">${item.Status || ''}</span></td>
                        <td>
                            <button class="btn btn-sm btn-info"><i class="fas fa-eye"></i></button>
                            <button class="btn btn-sm btn-warning"><i class="fas fa-edit"></i></button>
                        </td>
                    </tr>
                `;
                
                tableBody.append(row);
            });
            
            hideLoading();
        }
        
        // Load tahap bimbingan data
        function loadTahapBimbingan() {
            const tableBody = $('#tableTahapBimbingan tbody');
            tableBody.empty();
            
            if (bimbinganData.length === 0) {
                tableBody.append('<tr><td colspan="6" class="text-center">Tidak ada data tahap bimbingan</td></tr>');
                return;
            }
            
            bimbinganData.forEach(item => {
                const progress = Math.min(100, Math.floor(Math.random() * 100));
                
                const row = `
                    <tr>
                        <td>${item.NIM || ''}</td>
                        <td>${item.Nama || ''}</td>
                        <td>${getTahapBimbingan(progress)}</td>
                        <td>
                            <div class="progress">
                                <div class="progress-bar" role="progressbar" style="width: ${progress}%;">${progress}%</div>
                            </div>
                        </td>
                        <td>${new Date().toLocaleDateString('id-ID')}</td>
                        <td>
                            <button class="btn btn-sm btn-info"><i class="fas fa-eye"></i></button>
                            <button class="btn btn-sm btn-success"><i class="fas fa-check"></i></button>
                        </td>
                    </tr>
                `;
                
                tableBody.append(row);
            });
        }
        
        // Load status bimbingan data
        function loadStatusBimbingan() {
            const tableBody = $('#tableStatusBimbingan tbody');
            tableBody.empty();
            
            // Update stat cards
            $('#totalBimbingan').text(bimbinganData.length);
            $('#selesaiBimbingan').text(bimbinganData.filter(item => item.Status === 'Selesai').length);
            $('#prosesBimbingan').text(bimbinganData.filter(item => item.Status === 'Dalam Proses').length);
            $('#terlambatBimbingan').text(bimbinganData.filter(item => item.Status === 'Terlambat').length);
            
            if (bimbinganData.length === 0) {
                tableBody.append('<tr><td colspan="7" class="text-center">Tidak ada data status bimbingan</td></tr>');
                return;
            }
            
            bimbinganData.forEach(item => {
                const progress = Math.min(100, Math.floor(Math.random() * 100));
                const statusClass = getStatusClass(item.Status);
                const estSelesai = new Date();
                estSelesai.setDate(estSelesai.getDate() + Math.floor(Math.random() * 90));
                
                const row = `
                    <tr>
                        <td>${item.NIM || ''}</td>
                        <td>${item.Nama || ''}</td>
                        <td>${getProdiName(item.Prodi) || ''}</td>
                        <td>${item.Judul || ''}</td>
                        <td><span class="badge ${statusClass}">${item.Status || ''}</span></td>
                        <td>
                            <div class="progress" style="height: 10px;">
                                <div class="progress-bar" role="progressbar" style="width: ${progress}%;"></div>
                            </div>
                        </td>
                        <td>${estSelesai.toLocaleDateString('id-ID')}</td>
                    </tr>
                `;
                
                tableBody.append(row);
            });
        }
        
        // Load early warning data
        function loadEarlyWarning() {
            const tableBody = $('#tableEarlyWarning tbody');
            tableBody.empty();
            
            if (earlyWarningData.length === 0) {
                tableBody.append('<tr><td colspan="7" class="text-center">Tidak ada data early warning</td></tr>');
                return;
            }
            
            earlyWarningData.forEach(item => {
                const semester = calculateSemester(item.NIM);
                const statusClass = getStatusClass(item.Status);
                const warningLevel = getWarningLevel(semester);
                
                const row = `
                    <tr>
                        <td>${item.NIM || ''}</td>
                        <td>${item.Nama || ''}</td>
                        <td>${getProdiName(item.Prodi) || ''}</td>
                        <td>${semester}</td>
                        <td><span class="badge ${statusClass}">${item.Status || ''}</span></td>
                        <td><span class="badge bg-danger">${warningLevel}</span></td>
                        <td>
                            <button class="btn btn-sm btn-warning"><i class="fas fa-bell"></i> Notifikasi</button>
                        </td>
                    </tr>
                `;
                
                tableBody.append(row);
            });
        }
        
        // Load skripsi data
        function loadSkripsiData() {
            const tableBody = $('#tableSkripsi tbody');
            tableBody.empty();
            
            if (skripsiData.length === 0) {
                tableBody.append('<tr><td colspan="8" class="text-center">Tidak ada data skripsi</td></tr>');
                return;
            }
            
            skripsiData.forEach(item => {
                const statusClass = item.Status === 'Lulus' ? 'bg-success' : 'bg-warning';
                
                const row = `
                    <tr>
                        <td>${item.Judul || ''}</td>
                        <td>${item.Penulis || ''}</td>
                        <td>${item.Tahun || ''}</td>
                        <td>${getProdiName(item.Prodi) || ''}</td>
                        <td>${item.Pembimbing1 || ''}</td>
                        <td>${item.Pembimbing2 || ''}</td>
                        <td><span class="badge ${statusClass}">${item.Status || ''}</span></td>
                        <td>
                            <button class="btn btn-sm btn-info"><i class="fas fa-eye"></i></button>
                            <button class="btn btn-sm btn-primary"><i class="fas fa-download"></i></button>
                        </td>
                    </tr>
                `;
                
                tableBody.append(row);
            });
        }
        
        // Load statistik data
        function loadStatistikData() {
            // In a real application, this would come from the server
            updateProdiChart();
            updateStatusChart();
            updateWaktuChart();
            updateTrendChart();
        }
        
        // Initialize charts
        function initCharts() {
            // Charts will be initialized when statistik section is loaded
        }
        
        // Update prodi chart
        function updateProdiChart() {
            const ctx = document.getElementById('prodiChart').getContext('2d');
            
            // Sample data
            const data = {
                labels: ['Ekonomi Syariah', 'Perbankan Syariah', 'Manajemen Bisnis Syariah'],
                datasets: [{
                    label: 'Jumlah Bimbingan',
                    data: [25, 18, 22],
                    backgroundColor: [
                        'rgba(52, 152, 219, 0.7)',
                        'rgba(46, 204, 113, 0.7)',
                        'rgba(155, 89, 182, 0.7)'
                    ],
                    borderColor: [
                        'rgb(52, 152, 219)',
                        'rgb(46, 204, 113)',
                        'rgb(155, 89, 182)'
                    ],
                    borderWidth: 1
                }]
            };
            
            const config = {
                type: 'bar',
                data: data,
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Jumlah Bimbingan per Program Studi'
                        }
                    }
                },
            };
            
            new Chart(ctx, config);
        }
        
        // Update status chart
        function updateStatusChart() {
            const ctx = document.getElementById('statusChart').getContext('2d');
            
            // Sample data
            const data = {
                labels: ['Selesai', 'Dalam Proses', 'Terlambat'],
                datasets: [{
                    data: [35, 45, 20],
                    backgroundColor: [
                        'rgba(46, 204, 113, 0.7)',
                        'rgba(52, 152, 219, 0.7)',
                        'rgba(231, 76, 60, 0.7)'
                    ],
                    borderColor: [
                        'rgb(46, 204, 113)',
                        'rgb(52, 152, 219)',
                        'rgb(231, 76, 60)'
                    ],
                    borderWidth: 1
                }]
            };
            
            const config = {
                type: 'doughnut',
                data: data,
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Status Penyelesaian Skripsi'
                        }
                    }
                },
            };
            
            new Chart(ctx, config);
        }
        
        // Update waktu chart
        function updateWaktuChart() {
            const ctx = document.getElementById('waktuChart').getContext('2d');
            
            // Sample data
            const data = {
                labels: ['Ekonomi Syariah', 'Perbankan Syariah', 'Manajemen Bisnis Syariah'],
                datasets: [{
                    label: 'Rata-rata Waktu (bulan)',
                    data: [6.2, 5.8, 6.5],
                    backgroundColor: 'rgba(241, 196, 15, 0.7)',
                    borderColor: 'rgb(241, 196, 15)',
                    borderWidth: 1
                }]
            };
            
            const config = {
                type: 'bar',
                data: data,
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Rata-rata Waktu Penyelesaian Skripsi (bulan)'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                },
            };
            
            new Chart(ctx, config);
        }
        
        // Update trend chart
        function updateTrendChart() {
            const ctx = document.getElementById('trendChart').getContext('2d');
            
            // Sample data
            const data = {
                labels: ['2018', '2019', '2020', '2021', '2022'],
                datasets: [{
                    label: 'Jumlah Skripsi',
                    data: [15, 22, 30, 35, 42],
                    fill: false,
                    borderColor: 'rgb(75, 192, 192)',
                    tension: 0.1
                }]
            };
            
            const config = {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Trend Jumlah Skripsi per Tahun'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                },
            };
            
            new Chart(ctx, config);
        }
        
        // Handle skripsi upload form submission
        $('#uploadSkripsiForm').submit(function(e) {
            e.preventDefault();
            
            // Basic validation
            const nim = $('#nimSkripsi').val();
            const nama = $('#namaSkripsi').val();
            const prodi = $('#prodiSkripsi').val();
            const judul = $('#judulSkripsiFinal').val();
            const tahunLulus = $('#tahunLulus').val();
            const tanggalSidang = $('#tanggalSidang').val();
            const fileInput = $('#fileSkripsi')[0];
            const approval = $('#approvalCheck').is(':checked');
            
            if (!nim || !nama || !prodi || !judul || !tahunLulus || !tanggalSidang || !fileInput.files[0] || !approval) {
                showNotification('Harap lengkapi semua field dan centang persetujuan', 'warning');
                return;
            }
            
            const file = fileInput.files[0];
            
            // Validate file size
            if (file.size > 10 * 1024 * 1024) { // 10MB
                showNotification('Ukuran file terlalu besar. Maksimal 10MB.', 'warning');
                return;
            }
            
            // Show loading
            const submitBtn = $(this).find('button[type="submit"]');
            const originalText = submitBtn.html();
            submitBtn.html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Mengupload...');
            submitBtn.prop('disabled', true);
            
            // Convert file to base64
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = function() {
                const base64 = reader.result.split(',')[1];
                
                // Prepare data for submission
                const formData = new FormData();
                formData.append('action', 'uploadSkripsiFinal');
                formData.append('nim', nim);
                formData.append('nama', nama);
                formData.append('prodi', prodi);
                formData.append('judul', judul);
                formData.append('tahunLulus', tahunLulus);
                formData.append('tanggalSidang', tanggalSidang);
                formData.append('filename', file.name);
                formData.append('mimeType', file.type);
                formData.append('file', base64);
                
                // Send data to Google Apps Script
                fetch(scriptUrl, {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.result === 'success') {
                        showNotification('Skripsi final berhasil diupload dan data telah disinkronisasi!', 'success');
                        $('#uploadSkripsiForm')[0].reset();
                        
                        // Reload data to reflect changes
                        loadInitialData();
                    } else {
                        showNotification('Terjadi kesalahan: ' + data.message, 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showNotification('Terjadi kesalahan saat mengupload skripsi final.', 'error');
                })
                .finally(() => {
                    // Restore button
                    submitBtn.html(originalText);
                    submitBtn.prop('disabled', false);
                });
            };
            
            reader.onerror = function(error) {
                console.error('Error reading file:', error);
                showNotification('Terjadi kesalahan saat membaca file.', 'error');
                submitBtn.html(originalText);
                submitBtn.prop('disabled', false);
            };
        });
        
        // Filter skripsi table
        $('#filterTahun, #filterProdi, #filterStatus, #btnSearch').change(function() {
            // In a real application, this would filter the data from server
            // For now, we'll just show a message
            console.log('Filtering data...');
        });
        
        // Helper function to get status class for badges
        function getStatusClass(status) {
            switch(status) {
                case 'Selesai': return 'bg-success';
                case 'Dalam Proses': return 'bg-primary';
                case 'Terlambat': return 'bg-danger';
                default: return 'bg-secondary';
            }
        }
        
        // Helper function to get prodi name from code
        function getProdiName(code) {
            switch(code) {
                case 'ES': return 'Ekonomi Syariah';
                case 'PS': return 'Perbankan Syariah';
                case 'MBS': return 'Manajemen Bisnis Syariah';
                default: return code;
            }
        }
        
        // Helper function to calculate semester based on NIM
        function calculateSemester(nim) {
            if (!nim) return 0;
            
            // Extract year from NIM (assuming first two digits represent admission year)
            const admissionYear = parseInt('20' + nim.substring(0, 2));
            const currentYear = new Date().getFullYear();
            const currentMonth = new Date().getMonth();
            
            // Calculate approximate semester (2 semesters per year)
            let semester = (currentYear - admissionYear) * 2;
            
            // Adjust for current month (if after June, add one semester)
            if (currentMonth >= 6) semester += 1;
            
            return semester;
        }
        
        // Helper function to get warning level based on semester
        function getWarningLevel(semester) {
            if (semester >= 13) return 'SANGAT TINGGI';
            if (semester >= 11) return 'TINGGI';
            if (semester >= 9) return 'SEDANG';
            return 'RENDAH';
        }
        
        // Helper function to get tahap bimbingan based on progress
        function getTahapBimbingan(progress) {
            if (progress >= 75) return 'Bimbingan Skripsi';
            if (progress >= 50) return 'Seminar Hasil';
            if (progress >= 25) return 'Bimbingan Proposal';
            return 'Pengajuan Judul';
        }
        
        // Show notification
        function showNotification(message, type = 'info') {
            const toast = $('.toast');
            const toastBody = $('.toast-body');
            
            // Set message and style based on type
            toastBody.text(message);
            
            // Change header color based on type
            const header = toast.find('.toast-header');
            header.removeClass('bg-info bg-success bg-warning bg-danger');
            
            switch(type) {
                case 'success':
                    header.addClass('bg-success text-white');
                    break;
                case 'warning':
                    header.addClass('bg-warning text-dark');
                    break;
                case 'error':
                    header.addClass('bg-danger text-white');
                    break;
                default:
                    header.addClass('bg-info text-white');
            }
            
            // Show the toast
            toast.toast('show');
        }
        
        // Show loading state
        function showLoading() {
            $('#tableBimbingan tbody').html('<tr><td colspan="8" class="text-center"><div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div></td></tr>');
        }
        
        // Hide loading state
        function hideLoading() {
            // Loading state will be replaced with actual data
        }
    </script>
</body>
</html>


