<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Skripsi & Bimbingan</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --success-color: #27ae60;
            --warning-color: #f39c12;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            margin: 0;
            padding: 0;
        }
        
        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 250px;
            background-color: var(--secondary-color);
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: all 0.3s;
            z-index: 1000;
        }
        
        .sidebar-header {
            padding: 20px;
            background-color: var(--primary-color);
            text-align: center;
        }
        
        .sidebar-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .menu-item {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .menu-item a {
            color: white;
            padding: 15px 20px;
            display: block;
            text-decoration: none;
            transition: background-color 0.3s;
        }
        
        .menu-item a:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .menu-item.active > a {
            background-color: var(--primary-color);
            font-weight: bold;
        }
        
        .submenu {
            list-style: none;
            padding: 0;
            margin: 0;
            background-color: rgba(0, 0, 0, 0.2);
            display: none;
        }
        
        .menu-item.active .submenu {
            display: block;
        }
        
        .submenu-item a {
            padding: 12px 20px 12px 40px;
            font-size: 0.9rem;
        }
        
        .submenu-item.active a {
            background-color: var(--primary-color);
            font-weight: bold;
        }
        
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 20px;
        }
        
        .header {
            background-color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .stat-card i {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .stat-card.warning i {
            color: var(--warning-color);
        }
        
        .stat-card.danger i {
            color: var(--accent-color);
        }
        
        .stat-card.success i {
            color: var(--success-color);
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .content-section {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            display: none;
        }
        
        .content-section.active {
            display: block;
        }
        
        .chart-container {
            height: 300px;
            margin-bottom: 30px;
        }
        
        .filter-container {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .table-responsive {
            border-radius: 8px;
            overflow: hidden;
        }
        
        .similarity-check {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .similarity-result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }
        
        .high-similarity {
            background-color: #ffeaea;
            border-left: 4px solid var(--accent-color);
        }
        
        .medium-similarity {
            background-color: #fff4e5;
            border-left: 4px solid var(--warning-color);
        }
        
        .low-similarity {
            background-color: #eaffea;
            border-left: 4px solid var(--success-color);
        }
        
        .upload-area {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: border-color 0.3s;
        }
        
        .upload-area:hover {
            border-color: var(--primary-color);
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
            }
            
            .sidebar .menu-text, .sidebar-header h3 {
                display: none;
            }
            
            .submenu-item a {
                padding-left: 20px;
            }
            
            .main-content {
                margin-left: 70px;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar Menu -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h3><i class="fas fa-graduation-cap"></i> <span class="menu-text">Dashboard Skripsi</span></h3>
            </div>
            <ul class="sidebar-menu">
                <li class="menu-item active" data-menu="bimbingan">
                    <a href="#"><i class="fas fa-chalkboard-teacher"></i> <span class="menu-text">Bimbingan</span></a>
                    <ul class="submenu">
                        <li class="submenu-item active" data-content="pengajuan-proposal"><a href="#">Pengajuan Proposal</a></li>
                        <li class="submenu-item" data-content="data-bimbingan"><a href="#">Data Bimbingan</a></li>
                        <li class="submenu-item" data-content="tahap-bimbingan"><a href="#">Tahap Bimbingan</a></li>
                        <li class="submenu-item" data-content="status-bimbingan"><a href="#">Status Bimbingan</a></li>
                        <li class="submenu-item" data-content="early-warning"><a href="#">Early Warning</a></li>
                    </ul>
                </li>
                <li class="menu-item" data-menu="skripsi">
                    <a href="#"><i class="fas fa-book"></i> <span class="menu-text">Skripsi</span></a>
                    <ul class="submenu">
                        <li class="submenu-item" data-content="database-skripsi"><a href="#">Database Skripsi</a></li>
                        <li class="submenu-item" data-content="upload-skripsi"><a href="#">Upload Skripsi Final</a></li>
                    </ul>
                </li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h2>Dashboard Monitoring Skripsi & Bimbingan</h2>
                <div class="user-info">
                    <span>Selamat datang, Admin</span>
                </div>
            </div>

            <!-- Statistics Cards -->
            <div class="stats-container">
                <div class="stat-card">
                    <i class="fas fa-users"></i>
                    <div class="stat-value" id="total-mahasiswa">0</div>
                    <div class="stat-label">Total Mahasiswa</div>
                </div>
                <div class="stat-card warning">
                    <i class="fas fa-clock"></i>
                    <div class="stat-value" id="bimbingan-berjalan">0</div>
                    <div class="stat-label">Bimbingan Berjalan</div>
                </div>
                <div class="stat-card danger">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div class="stat-value" id="early-warning-count">0</div>
                    <div class="stat-label">Early Warning</div>
                </div>
                <div class="stat-card success">
                    <i class="fas fa-graduation-cap"></i>
                    <div class="stat-value" id="skripsi-selesai">0</div>
                    <div class="stat-label">Skripsi Selesai</div>
                </div>
            </div>

            <!-- Charts -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="content-section active">
                        <h4>Statistik Bimbingan per Prodi</h4>
                        <div class="chart-container">
                            <canvas id="prodiChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="content-section active">
                        <h4>Status Penyelesaian Skripsi</h4>
                        <div class="chart-container">
                            <canvas id="statusChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content Sections -->
            <!-- Pengajuan Proposal -->
            <div class="content-section active" id="pengajuan-proposal">
                <h4>Pengajuan Proposal Skripsi</h4>
                <div class="similarity-check">
                    <h5>Cek Similarity Judul</h5>
                    <div class="mb-3">
                        <label for="judul-proposal" class="form-label">Masukkan Judul Proposal</label>
                        <input type="text" class="form-control" id="judul-proposal" placeholder="Masukkan judul proposal Anda">
                    </div>
                    <button class="btn btn-primary" id="cek-similarity">Cek Similarity</button>
                    
                    <div class="similarity-result" id="similarity-result">
                        <h5>Hasil Pengecekan Similarity</h5>
                        <p id="similarity-value"></p>
                        <div id="similarity-matches"></div>
                    </div>
                </div>
                
                <h5 class="mt-4">Form Pengajuan Proposal</h5>
                <form id="proposal-form">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="nim" class="form-label">NIM</label>
                                <input type="text" class="form-control" id="nim" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="nama" class="form-label">Nama Mahasiswa</label>
                                <input type="text" class="form-control" id="nama" required>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="prodi" class="form-label">Program Studi</label>
                                <select class="form-select" id="prodi" required>
                                    <option value="">Pilih Program Studi</option>
                                    <option value="Ekonomi Syariah">Ekonomi Syariah</option>
                                    <option value="Perbankan Syariah">Perbankan Syariah</option>
                                    <option value="Manajemen Bisnis Syariah">Manajemen Bisnis Syariah</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="dosen" class="form-label">Dosen Pembimbing</label>
                                <select class="form-select" id="dosen" required>
                                    <option value="">Pilih Dosen Pembimbing</option>
                                    <!-- Options will be populated from Google Sheets -->
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="judul" class="form-label">Judul Proposal</label>
                        <textarea class="form-control" id="judul" rows="2" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Ajukan Proposal</button>
                </form>
            </div>

            <!-- Data Bimbingan -->
            <div class="content-section" id="data-bimbingan">
                <h4>Data Bimbingan Skripsi</h4>
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>NIM</th>
                                <th>Nama Mahasiswa</th>
                                <th>Dosen Pembimbing</th>
                                <th>Judul Skripsi</th>
                                <th>Tanggal Mulai</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="bimbingan-table-body">
                            <!-- Data will be populated from Google Sheets -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Tahap Bimbingan -->
            <div class="content-section" id="tahap-bimbingan">
                <h4>Tahap Bimbingan Skripsi</h4>
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>NIM</th>
                                <th>Nama Mahasiswa</th>
                                <th>Tahap</th>
                                <th>Progress</th>
                                <th>Tanggal Bimbingan Terakhir</th>
                                <th>Keterangan</th>
                            </tr>
                        </thead>
                        <tbody id="tahap-table-body">
                            <!-- Data will be populated from Google Sheets -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Status Bimbingan -->
            <div class="content-section" id="status-bimbingan">
                <h4>Status Bimbingan Skripsi</h4>
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>NIM</th>
                                <th>Nama Mahasiswa</th>
                                <th>Dosen Pembimbing</th>
                                <th>Status</th>
                                <th>Progress</th>
                                <th>Estimasi Selesai</th>
                            </tr>
                        </thead>
                        <tbody id="status-table-body">
                            <!-- Data will be populated from Google Sheets -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Early Warning -->
            <div class="content-section" id="early-warning">
                <h4>Early Warning Mahasiswa</h4>
                <p>Daftar mahasiswa semester 10-14 yang belum menyelesaikan skripsi</p>
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>NIM</th>
                                <th>Nama Mahasiswa</th>
                                <th>Semester</th>
                                <th>Dosen Pembimbing</th>
                                <th>Tanggal Mulai</th>
                                <th>Status</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="warning-table-body">
                            <!-- Data will be populated from Google Sheets -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Database Skripsi -->
            <div class="content-section" id="database-skripsi">
                <h4>Database Skripsi</h4>
                <div class="filter-container">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="mb-3">
                                <label for="tahun-filter" class="form-label">Tahun Lulus</label>
                                <select class="form-select" id="tahun-filter">
                                    <option value="">Semua Tahun</option>
                                    <!-- Options will be populated from Google Sheets -->
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="mb-3">
                                <label for="prodi-filter" class="form-label">Program Studi</label>
                                <select class="form-select" id="prodi-filter">
                                    <option value="">Semua Program Studi</option>
                                    <option value="Ekonomi Syariah">Ekonomi Syariah</option>
                                    <option value="Perbankan Syariah">Perbankan Syariah</option>
                                    <option value="Manajemen Bisnis Syariah">Manajemen Bisnis Syariah</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="mb-3">
                                <label for="status-filter" class="form-label">Status</label>
                                <select class="form-select" id="status-filter">
                                    <option value="">Semua Status</option>
                                    <option value="Lulus">Lulus</option>
                                    <option value="Dalam Proses">Dalam Proses</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="mb-3">
                                <label for="search-input" class="form-label">Pencarian Judul</label>
                                <input type="text" class="form-control" id="search-input" placeholder="Cari judul skripsi">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Judul Skripsi</th>
                                <th>Penulis</th>
                                <th>Tahun</th>
                                <th>Program Studi</th>
                                <th>Status</th>
                                <th>Dosen Pembimbing</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="skripsi-table-body">
                            <!-- Data will be populated from Google Sheets -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Upload Skripsi Final -->
            <div class="content-section" id="upload-skripsi">
                <h4>Upload Skripsi Final</h4>
                <form id="upload-form">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="upload-nim" class="form-label">NIM</label>
                                <input type="text" class="form-control" id="upload-nim" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="upload-nama" class="form-label">Nama Mahasiswa</label>
                                <input type="text" class="form-control" id="upload-nama" required>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="upload-prodi" class="form-label">Program Studi</label>
                                <select class="form-select" id="upload-prodi" required>
                                    <option value="">Pilih Program Studi</option>
                                    <option value="Ekonomi Syariah">Ekonomi Syariah</option>
                                    <option value="Perbankan Syariah">Perbankan Syariah</option>
                                    <option value="Manajemen Bisnis Syariah">Manajemen Bisnis Syariah</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="upload-tahun" class="form-label">Tahun Lulus</label>
                                <input type="number" class="form-control" id="upload-tahun" min="2000" max="2030" required>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="upload-judul" class="form-label">Judul Skripsi</label>
                        <textarea class="form-control" id="upload-judul" rows="2" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="upload-dosen" class="form-label">Dosen Pembimbing</label>
                        <input type="text" class="form-control" id="upload-dosen" required>
                    </div>
                    <div class="upload-area" id="drop-zone">
                        <i class="fas fa-cloud-upload-alt fa-3x mb-3"></i>
                        <p>Drag & drop file skripsi here or click to browse</p>
                        <input type="file" id="file-input" hidden accept=".pdf,.doc,.docx">
                        <p class="text-muted">Format file: PDF, DOC, DOCX (Maks. 10MB)</p>
                    </div>
                    <div id="file-info" class="mb-3" style="display: none;">
                        <p>File terpilih: <span id="file-name"></span> (<span id="file-size"></span>)</p>
                    </div>
                    <button type="submit" class="btn btn-primary">Upload Skripsi</button>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // URL Google Apps Script Web App
        const scriptURL = 'https://script.google.com/macros/s/1DkWgjb6jVQ96cSd6oP9k00vo9NYiWwGt7ZI8CGcMm0/exec';
        
        // Global variables
        let bimbinganData = [];
        let skripsiData = [];
        let earlyWarningData = [];
        let skripsiFinalData = [];
        
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize menu functionality
            initMenu();
            
            // Load data from Google Sheets
            loadData();
            
            // Initialize charts
            initCharts();
            
            // Setup event listeners
            setupEventListeners();
        });
        
        function initMenu() {
            // Main menu click handler
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    if (e.target.tagName === 'A') {
                        // Remove active class from all menu items
                        document.querySelectorAll('.menu-item').forEach(i => {
                            i.classList.remove('active');
                        });
                        
                        // Add active class to clicked menu item
                        this.classList.add('active');
                        
                        // If this menu has submenu, show the first submenu item
                        const submenu = this.querySelector('.submenu');
                        if (submenu) {
                            const firstSubItem = submenu.querySelector('.submenu-item');
                            if (firstSubItem) {
                                // Remove active class from all submenu items
                                document.querySelectorAll('.submenu-item').forEach(i => {
                                    i.classList.remove('active');
                                });
                                
                                // Add active class to first submenu item
                                firstSubItem.classList.add('active');
                                
                                // Show corresponding content
                                showContent(firstSubItem.getAttribute('data-content'));
                            }
                        }
                    }
                });
            });
            
            // Submenu click handler
            document.querySelectorAll('.submenu-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Remove active class from all submenu items in the same submenu
                    const submenu = this.closest('.submenu');
                    submenu.querySelectorAll('.submenu-item').forEach(i => {
                        i.classList.remove('active');
                    });
                    
                    // Add active class to clicked submenu item
                    this.classList.add('active');
                    
                    // Show corresponding content
                    showContent(this.getAttribute('data-content'));
                });
            });
        }
        
        function showContent(contentId) {
            // Hide all content sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show the selected content section
            document.getElementById(contentId).classList.add('active');
        }
        
        function loadData() {
            // Load data from all sheets
            Promise.all([
                fetchData('getBimbingan'),
                fetchData('getSkripsi'),
                fetchData('getEarlyWarning'),
                fetchData('getSkripsiFinal')
            ]).then(([bimbingan, skripsi, earlyWarning, skripsiFinal]) => {
                bimbinganData = bimbingan;
                skripsiData = skripsi;
                earlyWarningData = earlyWarning;
                skripsiFinalData = skripsiFinal;
                
                // Update statistics
                updateStatistics();
                
                // Populate tables
                populateBimbinganTable();
                populateTahapTable();
                populateStatusTable();
                populateWarningTable();
                populateSkripsiTable();
                
                // Update charts
                updateCharts();
                
                // Populate filters
                populateFilters();
            }).catch(error => {
                console.error('Error loading data:', error);
            });
        }
        
        function fetchData(action) {
            return fetch(`${scriptURL}?action=${action}`)
                .then(response => response.json())
                .catch(error => {
                    console.error(`Error fetching ${action} data:`, error);
                    return [];
                });
        }
        
        function updateStatistics() {
            // Update statistics cards with dummy data (replace with actual calculations)
            document.getElementById('total-mahasiswa').textContent = bimbinganData.length;
            document.getElementById('bimbingan-berjalan').textContent = bimbinganData.filter(item => item.Status === 'Aktif').length;
            document.getElementById('early-warning-count').textContent = earlyWarningData.length;
            document.getElementById('skripsi-selesai').textContent = skripsiFinalData.length;
        }
        
        function initCharts() {
            // Initialize charts with empty data
            window.prodiChart = new Chart(document.getElementById('prodiChart'), {
                type: 'bar',
                data: {
                    labels: ['Ekonomi Syariah', 'Perbankan Syariah', 'Manajemen Bisnis Syariah'],
                    datasets: [{
                        label: 'Jumlah Mahasiswa',
                        data: [0, 0, 0],
                        backgroundColor: ['#3498db', '#2ecc71', '#9b59b6']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            window.statusChart = new Chart(document.getElementById('statusChart'), {
                type: 'pie',
                data: {
                    labels: ['Lulus', 'Dalam Proses', 'Belum Mulai'],
                    datasets: [{
                        data: [0, 0, 0],
                        backgroundColor: ['#2ecc71', '#f39c12', '#e74c3c']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }
        
        function updateCharts() {
            // Update charts with actual data (simplified for demo)
            if (window.prodiChart && bimbinganData.length > 0) {
                // Count by program study (dummy data - replace with actual data processing)
                const prodiCount = {
                    'Ekonomi Syariah': Math.floor(Math.random() * 50) + 30,
                    'Perbankan Syariah': Math.floor(Math.random() * 50) + 30,
                    'Manajemen Bisnis Syariah': Math.floor(Math.random() * 50) + 30
                };
                
                window.prodiChart.data.datasets[0].data = [
                    prodiCount['Ekonomi Syariah'],
                    prodiCount['Perbankan Syariah'],
                    prodiCount['Manajemen Bisnis Syariah']
                ];
                window.prodiChart.update();
            }
            
            if (window.statusChart && skripsiData.length > 0) {
                // Count by status (dummy data - replace with actual data processing)
                const statusCount = {
                    'Lulus': Math.floor(Math.random() * 40) + 20,
                    'Dalam Proses': Math.floor(Math.random() * 40) + 20,
                    'Belum Mulai': Math.floor(Math.random() * 40) + 20
                };
                
                window.statusChart.data.datasets[0].data = [
                    statusCount['Lulus'],
                    statusCount['Dalam Proses'],
                    statusCount['Belum Mulai']
                ];
                window.statusChart.update();
            }
        }
        
        function setupEventListeners() {
            // Similarity check
            document.getElementById('cek-similarity').addEventListener('click', function() {
                const judul = document.getElementById('judul-proposal').value.trim();
                if (judul) {
                    checkSimilarity(judul);
                } else {
                    alert('Masukkan judul proposal terlebih dahulu');
                }
            });
            
            // Proposal form submission
            document.getElementById('proposal-form').addEventListener('submit', function(e) {
                e.preventDefault();
                alert('Proposal berhasil diajukan! Data akan diverifikasi oleh admin.');
                this.reset();
            });
            
            // Upload form submission
            document.getElementById('upload-form').addEventListener('submit', function(e) {
                e.preventDefault();
                alert('Skripsi berhasil diupload! Data akan diproses oleh admin.');
                this.reset();
                document.getElementById('file-info').style.display = 'none';
            });
            
            // File upload handling
            const dropZone = document.getElementById('drop-zone');
            const fileInput = document.getElementById('file-input');
            
            dropZone.addEventListener('click', function() {
                fileInput.click();
            });
            
            fileInput.addEventListener('change', function() {
                if (this.files.length > 0) {
                    displayFileInfo(this.files[0]);
                }
            });
            
            dropZone.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.style.borderColor = '#3498db';
                this.style.backgroundColor = '#f8f9fa';
            });
            
            dropZone.addEventListener('dragleave', function() {
                this.style.borderColor = '#ccc';
                this.style.backgroundColor = 'transparent';
            });
            
            dropZone.addEventListener('drop', function(e) {
                e.preventDefault();
                this.style.borderColor = '#ccc';
                this.style.backgroundColor = 'transparent';
                
                if (e.dataTransfer.files.length > 0) {
                    fileInput.files = e.dataTransfer.files;
                    displayFileInfo(e.dataTransfer.files[0]);
                }
            });
            
            // Filter functionality for database skripsi
            document.getElementById('tahun-filter').addEventListener('change', filterSkripsiTable);
            document.getElementById('prodi-filter').addEventListener('change', filterSkripsiTable);
            document.getElementById('status-filter').addEventListener('change', filterSkripsiTable);
            document.getElementById('search-input').addEventListener('input', filterSkripsiTable);
        }
        
        function checkSimilarity(judul) {
            // Simulate similarity check (in a real application, this would call an API)
            const similarityResult = document.getElementById('similarity-result');
            const similarityValue = document.getElementById('similarity-value');
            const similarityMatches = document.getElementById('similarity-matches');
            
            // Show loading state
            similarityResult.style.display = 'block';
            similarityResult.className = 'similarity-result';
            similarityValue.textContent = 'Memeriksa similarity...';
            similarityMatches.innerHTML = '';
            
            // Simulate API call delay
            setTimeout(() => {
                const similarityScore = Math.random() * 100;
                
                if (similarityScore > 50) {
                    similarityResult.classList.add('high-similarity');
                    similarityValue.innerHTML = `<strong>Tingkat Similarity Tinggi: ${similarityScore.toFixed(2)}%</strong><br>
                    Judul proposal Anda memiliki similarity tinggi dengan judul yang sudah ada. Silahkan revisi judul Anda.`;
                } else if (similarityScore > 25) {
                    similarityResult.classList.add('medium-similarity');
                    similarityValue.innerHTML = `<strong>Tingkat Similarity Sedang: ${similarityScore.toFixed(2)}%</strong><br>
                    Judul proposal Anda memiliki similarity sedang dengan judul yang sudah ada. Pertimbangkan untuk merevisi judul Anda.`;
                } else {
                    similarityResult.classList.add('low-similarity');
                    similarityValue.innerHTML = `<strong>Tingkat Similarity Rendah: ${similarityScore.toFixed(2)}%</strong><br>
                    Judul proposal Anda memiliki similarity rendah dengan judul yang sudah ada. Judul dapat diajukan.`;
                }
                
                // Add some example matches (in a real application, these would come from the API)
                if (similarityScore > 25) {
                    similarityMatches.innerHTML = `
                        <h6>Judul yang Mirip:</h6>
                        <ul>
                            <li>Implementasi Sistem Ekonomi Syariah di Indonesia (Similarity: ${(similarityScore * 0.8).toFixed(2)}%)</li>
                            <li>Analisis Perbankan Syariah dalam Pertumbuhan Ekonomi (Similarity: ${(similarityScore * 0.6).toFixed(2)}%)</li>
                        </ul>
                    `;
                }
            }, 1500);
        }
        
        function displayFileInfo(file) {
            const fileInfo = document.getElementById('file-info');
            const fileName = document.getElementById('file-name');
            const fileSize = document.getElementById('file-size');
            
            // Validate file type
            const validTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
            if (!validTypes.includes(file.type)) {
                alert('Format file tidak didukung. Silahkan upload file PDF, DOC, atau DOCX.');
                return;
            }
            
            // Validate file size (max 10MB)
            if (file.size > 10 * 1024 * 1024) {
                alert('Ukuran file terlalu besar. Maksimal 10MB.');
                return;
            }
            
            // Display file info
            fileName.textContent = file.name;
            fileSize.textContent = formatFileSize(file.size);
            fileInfo.style.display = 'block';
        }
        
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' bytes';
            else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
            else return (bytes / 1048576).toFixed(1) + ' MB';
        }
        
        function populateBimbinganTable() {
            const tableBody = document.getElementById('bimbingan-table-body');
            tableBody.innerHTML = '';
            
            // Add sample data (replace with actual data from bimbinganData)
            const sampleData = [
                { NIM: '202001001', Nama: 'Ahmad Susanto', Dosen: 'Dr. Muhammad Ali, M.E.I.', Judul: 'Analisis Perbankan Syariah di Indonesia', Tanggal: '2023-01-15', Status: 'Aktif' },
                { NIM: '202001002', Nama: 'Siti Rahayu', Dosen: 'Dr. Fatimah Zahra, M.Si.', Judul: 'Implementasi Ekonomi Syariah dalam UMKM', Tanggal: '2023-02-20', Status: 'Aktif' },
                { NIM: '202001003', Nama: 'Budi Santoso', Dosen: 'Prof. Abdul Rahman, M.A.', Judul: 'Dampak Digitalisasi pada Perbankan Syariah', Tanggal: '2022-11-10', Status: 'Selesai' }
            ];
            
            sampleData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.NIM}</td>
                    <td>${item.Nama}</td>
                    <td>${item.Dosen}</td>
                    <td>${item.Judul}</td>
                    <td>${item.Tanggal}</td>
                    <td><span class="badge ${item.Status === 'Aktif' ? 'bg-warning' : 'bg-success'}">${item.Status}</span></td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function populateTahapTable() {
            const tableBody = document.getElementById('tahap-table-body');
            tableBody.innerHTML = '';
            
            // Add sample data
            const sampleData = [
                { NIM: '202001001', Nama: 'Ahmad Susanto', Tahap: 'Bab 3', Progress: '65%', Tanggal: '2023-05-15', Keterangan: 'Revisi metodologi' },
                { NIM: '202001002', Nama: 'Siti Rahayu', Tahap: 'Bab 4', Progress: '80%', Tanggal: '2023-05-18', Keterangan: 'Analisis data' },
                { NIM: '202001003', Nama: 'Budi Santoso', Tahap: 'Selesai', Progress: '100%', Tanggal: '2023-04-30', Keterangan: 'Sudah lulus' }
            ];
            
            sampleData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.NIM}</td>
                    <td>${item.Nama}</td>
                    <td>${item.Tahap}</td>
                    <td>
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: ${item.Progress};" aria-valuenow="${item.Progress.replace('%', '')}" aria-valuemin="0" aria-valuemax="100">${item.Progress}</div>
                        </div>
                    </td>
                    <td>${item.Tanggal}</td>
                    <td>${item.Keterangan}</td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function populateStatusTable() {
            const tableBody = document.getElementById('status-table-body');
            tableBody.innerHTML = '';
            
            // Add sample data
            const sampleData = [
                { NIM: '202001001', Nama: 'Ahmad Susanto', Dosen: 'Dr. Muhammad Ali, M.E.I.', Status: 'Bimbingan', Progress: '65%', Estimasi: '2023-07-30' },
                { NIM: '202001002', Nama: 'Siti Rahayu', Dosen: 'Dr. Fatimah Zahra, M.Si.', Status: 'Bimbingan', Progress: '80%', Estimasi: '2023-06-15' },
                { NIM: '202001003', Nama: 'Budi Santoso', Dosen: 'Prof. Abdul Rahman, M.A.', Status: 'Lulus', Progress: '100%', Estimasi: '2023-04-30' }
            ];
            
            sampleData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.NIM}</td>
                    <td>${item.Nama}</td>
                    <td>${item.Dosen}</td>
                    <td><span class="badge ${item.Status === 'Lulus' ? 'bg-success' : 'bg-primary'}">${item.Status}</span></td>
                    <td>
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: ${item.Progress};" aria-valuenow="${item.Progress.replace('%', '')}" aria-valuemin="0" aria-valuemax="100">${item.Progress}</div>
                        </div>
                    </td>
                    <td>${item.Estimasi}</td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function populateWarningTable() {
            const tableBody = document.getElementById('warning-table-body');
            tableBody.innerHTML = '';
            
            // Add sample data from earlyWarningData
            earlyWarningData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.NIM || 'N/A'}</td>
                    <td>${item.Nama || 'N/A'}</td>
                    <td>${item.Semester || 'N/A'}</td>
                    <td>${item.DosenPembimbing || 'N/A'}</td>
                    <td>${item.TanggalMulai || 'N/A'}</td>
                    <td><span class="badge bg-danger">${item.Status || 'N/A'}</span></td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary">Kirim Pengingat</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // If no data, add a message
            if (earlyWarningData.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="7" class="text-center">Tidak ada data early warning</td>
                `;
                tableBody.appendChild(row);
            }
        }
        
        function populateSkripsiTable() {
            const tableBody = document.getElementById('skripsi-table-body');
            tableBody.innerHTML = '';
            
            // Add sample data from skripsiData
            skripsiData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.Judul || 'N/A'}</td>
                    <td>${item.Penulis || 'N/A'}</td>
                    <td>${item.Tahun || 'N/A'}</td>
                    <td>${item.ProgramStudi || 'N/A'}</td>
                    <td><span class="badge ${item.Status === 'Lulus' ? 'bg-success' : 'bg-warning'}">${item.Status || 'N/A'}</span></td>
                    <td>${item.DosenPembimbing || 'N/A'}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary">Lihat Detail</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // If no data, add a message
            if (skripsiData.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="7" class="text-center">Tidak ada data skripsi</td>
                `;
                tableBody.appendChild(row);
            }
        }
        
        function populateFilters() {
            const tahunFilter = document.getElementById('tahun-filter');
            
            // Get unique years from skripsiData
            const years = [...new Set(skripsiData.map(item => item.Tahun))].filter(year => year).sort((a, b) => b - a);
            
            // Add year options to filter
            years.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                tahunFilter.appendChild(option);
            });
        }
        
        function filterSkripsiTable() {
            const tahun = document.getElementById('tahun-filter').value;
            const prodi = document.getElementById('prodi-filter').value;
            const status = document.getElementById('status-filter').value;
            const searchText = document.getElementById('search-input').value.toLowerCase();
            
            const tableBody = document.getElementById('skripsi-table-body');
            const rows = tableBody.getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                let showRow = true;
                
                // Skip if this is the "no data" row
                if (cells.length < 2) continue;
                
                // Apply filters
                if (tahun && cells[2].textContent !== tahun) {
                    showRow = false;
                }
                
                if (prodi && cells[3].textContent !== prodi) {
                    showRow = false;
                }
                
                if (status) {
                    const statusText = cells[4].textContent;
                    if ((status === 'Lulus' && statusText !== 'Lulus') || 
                        (status === 'Dalam Proses' && statusText === 'Lulus')) {
                        showRow = false;
                    }
                }
                
                if (searchText && !cells[0].textContent.toLowerCase().includes(searchText)) {
                    showRow = false;
                }
                
                // Show or hide the row based on filters
                rows[i].style.display = showRow ? '' : 'none';
            }
        }
    </script>
</body>
</html>
